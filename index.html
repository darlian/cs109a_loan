<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Predicting Loan Defaults with Machine Learning by darlian</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Predicting Loan Defaults with Machine Learning</h1>
      <h2 class="project-tagline">Darrell Lian, Peter Willis and Aaron Myran, CS109a 2016</h2>
      <a href="#introduction-and-objectives" class="btn">Introduction</a>
      <a href="#methods" class="btn">Methods</a>
      <a href="#results" class="btn">Results</a>
      <a href="#conclusion" class="btn">Conclusion</a>
      <a href="https://github.com/darlian/cs109a_loan" class="btn">View on GitHub</a>
    </section>

    <section class="main-content">
      <h1>
      <a id="introduction-and-objectives" class="anchor" href="#introduction-and-objectives" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Introduction and Objectives.</h1>

      <p>LPeer-2-peer financial institutions like <strong>Lending Club</strong> are exposed to risk from loan default. When a customer defaults on a loan, Lending Club and its investors risk losing their money.</p>    
      <p>To mitigate the risk from default, Lending Club has developed a grading system to classify potential customers. They have also published data on the loans, allowing researchers to study determinants of loan default.</p>
      <p><a href="http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0139427"> Researchers have found </a> that Lending Club's grade and associated interest rate is highly predictive of loan default. They have also found measures of borrower indebtness to be highly predictive of loan default.</p>

      <p>Our project builds on this research, applying machine learning techniques to create a predictive model for loan defaults. Specifically, we are looking at predicting defaults among two populations:</p>

      <ul>
        <li><strong> Lending Club’s current loans </strong> - where Lending Club has data on the individual's payment history</li>
        <li> <strong> New Lending Club customers </strong> - where Lending Club has only basic demographic and financial data</li>
      </ul>

      <h1>
      <a id="methods" class="anchor" href="#methods" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Methods.</h1>

      <h2>
      <a id="data-exploration" class="anchor" href="#data-exploration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Data exploration</h2>

      <p>We used open data from <a href="https://www.kaggle.com/wendykan/lending-club-loan-data">Lending Club</a>, on loans issued by the platform from 2007-2015. There were <strong>887,379 loans</strong> in the dataset, and <strong>74 predictor variables</strong>. </p>

      <p>We worked to understand the loan grade assigned by Lending Club (A through to F). We found that the loan grade was highly correlated to the interest rate -- correlation coefficient of 0.9541. This suggests that the Lending Club uses loan grade to determine interest rate to a great extent.</p>

      <p><img src="https://raw.githubusercontent.com/darlian/cs109a_loan/gh-pages/loan%20grade%20distribution.png" alt="Loan grade box and whisker" height = "42" width = "42"></p>
      <p> We visualized data on the demographic nature of loan defaults. Key findings included:</p>
      <ul>
        <li> Individuals who defaulted on their loans had few previous delinquent accounts </li>
        <li> Individuals with all levels of work experience defaulted on their loans </li>
        <li> There were very few cases of individuals with self reported incomes greater than $50,000 defaulting on their loans </li>
      </ul>
      <p><img src="https://raw.githubusercontent.com/darlian/cs109a_loan/gh-pages/Hist_work_exp.png" alt="Work experience histogram" align = "middle"></p>
      <p><img src="https://raw.githubusercontent.com/darlian/cs109a_loan/gh-pages/scatter_openAccounts_AnnualIncome.png" alt="Scatter plot of income" align = "middle"></p>
  
      <h2>
      <a id="data-pre-processing" class="anchor" href="#data-pre-processing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Data pre-processing</h2>

      <p>In preparation to create predictive models for our two populations of interest we then proceeded to clean the data:</p>

      <ol>
        <li>Removed loans whose "loan status" was "Current". This left us with approximately <strong>250,000 loans</strong> in the dataset.</li>
        <li>Recoded "loan status" to a variable called "default", with loans being assigned a value of "0" (if they had/were not in default), and "1" (if they had defaulted). Defaulted loans constituted about <strong>16.6%</strong> of all loans. </li>
        <li>Removed all predictor variables which contained &gt;70% missing values.</li>
        <li>Imputed all remaining missing values with the median value of their respective predictor variable column. This approach was relatively unproblematic, as we had a high number of remaining observations in our dataset (250,000). </li>
     </ol>

     <p> We also removed the loan grade and interest rate from the data, since these are created by Lending Club.</p>
     <p> For the model on new Lending Club customers, we removed all payment data - e.g. monthly installments paid - since Lending Club would not have that data on new customers.</p>
 
     <h2>
     <a id="model-fitting" class="anchor" href="#model-fitting" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Model fitting</h2>

     <p>We then split the data into training and testing datasets (60% training - 40% testing), and fit the following 5 models on the training dataset:</p>

     <ul>
       <li>Logistic regression</li>
       <li>Linear Discriminant Analysis</li>
       <li>Quadratic Discriminant Analysis</li>
       <li>Decision Trees</li>
       <li>Random Forests</li>
    </ul>
    <h2>
    <a id="cross-validation" class="anchor" href="#cross-validation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Cross-validation</h2>

    <p>Thereafter, we performed 5-fold cross-validation on the training data for the 3 models which most accurately predicted loan defaults in the initial run:</p>

    <ul>
      <li>Logistic regression (<strong>C regularization parameter</strong>)</li>
      <li>Decision Trees (<strong>depth of tree</strong>, <strong>minimum number of samples per leaf</strong>)</li>
      <li>Random Forests (<strong>number of trees</strong>)</li>
    </ul>
    <p> When performing the 5-fold cross-validation we split the training data into folds, holding out the test set. We then scored the models on the test set, to try to prevent overfitting as much as possible.</p>
 
    <h1>
    <a id="results" class="anchor" href="#results" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Results.</h1>

    <h2>
    <a id="model-selection" class="anchor" href="#model-selection" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Model selection</h2>

    <p>Our optimal model after cross validation, judged by predictive accuracy on class 1, was <strong>regularized logistic regression</strong>.</p>

    <p><img src="https://raw.githubusercontent.com/darlian/cs109a_loan/gh-pages/predictive%20accuracy%20-%20table.png" alt="Image of Predictive Accuracy"></p>

    <p>We tuned the value of the regularization parameter of the logistic regression model, to maximize predictive accuracy on class 1. A <strong>value of 10^-3</strong> generated the best score.</p>

    <p><img src="https://raw.githubusercontent.com/darlian/cs109a_loan/gh-pages/CV_logreg.png" alt="Image of CV"></p>

    <h2>
    <a id="feature-importance" class="anchor" href="#feature-importance" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Feature importance</h2>

    <p>Insert decision tree.</p>

    <p>Last Payment Amount
    1.1 : Outstanding Loan Principal (Investors)
      Split 1.1.1: Total Principal Received 
      Split 1.1.2: Total Payment Received (Investors)
      1.2: Total Late Fees Received
      Split 1.2.1: Installments
      Split 1.2.2: Total Principal Received </p>

    <p>Variables related to a borrower’s past payment behaviour were the most predictive of a current borrower’s eventual default, which makes intuitive sense. However, for new borrowers, other variables like FICO score would be salient.</p>

    <h2>
    <a id="model-removing-features-related-to-payments-on-ongoing-loans" class="anchor" href="#model-removing-features-related-to-payments-on-ongoing-loans" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Model removing features related to payments on ongoing loans</h2>

    <p>Insert info.</p>

    <h1>
    <a id="conclusion" class="anchor" href="#conclusion" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Conclusion and Further Work</h1>

      
      
      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/darlian/cs109a_loan">Predicting Loan Defaults with Machine Learning</a> is maintained by <a href="https://github.com/darlian">darlian</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
